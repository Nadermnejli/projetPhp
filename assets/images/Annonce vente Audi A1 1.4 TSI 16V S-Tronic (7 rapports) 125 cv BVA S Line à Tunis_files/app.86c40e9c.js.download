var M=Object.defineProperty;var q=(d,t,e)=>t in d?M(d,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):d[t]=e;var g=(d,t,e)=>(q(d,typeof t!="symbol"?t+"":t,e),e);import{Q as N,I as V,C as B,J as U,g as X,b as z}from"./vendor.d835403c.js";yii.confirm=function(d,t,e){$("body").overhang({type:"confirm",message:"<p>"+d+"</p>",primary:"#000000",accent:"#d90000",html:!0,overlay:!0,yesColor:"#d90000",yesMessage:"Oui",noColor:"#999",noMessage:"Non",overlayColor:"#bcbcbc",closeConfirm:!1,callback:function(n){n?!t||t():!e||e()}})};$(function(){$(".breadcrumbs .icon").on("click",function(){return $(".breadcrumbs .siblings").hide(),$(this).next(".siblings").show(),document.body.clientWidth<767}),$(".breadcrumbs .body_icon").on("click",function(){return $(".breadcrumbs .siblings").hide(),$(this).next().next(".siblings").show(),document.body.clientWidth<767}),$(document).on("click",function(){$(".breadcrumbs .siblings").hide()})});$(function(){$(".footer-newsletter form").on("submit",function(){return $(".footer-newsletter input[type=submit]").prop("disabled",!0),$.post($(this).attr("action"),{email:$(this).find('input[type="email"]').val()},function(d){$("body").overhang({custom:!0,message:"<p>"+d.message+"</p>",primary:"#000000",accent:d.success?"#27ae60":"#d90000",html:!0,closeConfirm:d.closeConfirm||!1}),d.success&&$(".footer-newsletter input[type=email]").val(""),$(".footer-newsletter input[type=submit]").prop("disabled",!1)}),!1})});$(function(){$(".plus").on("click",function(){$(".submenu").hide(),$(this).next(".submenu").slideToggle("fast")})});function j(){return getComputedStyle(document.documentElement).getPropertyValue("--safe-area-inset-top")||"0"}$(function(){let d=!0;$(window).on("scroll",function(){let e=30;if(document.body.clientWidth>=992)e=47;else if(CSS.supports("-webkit-touch-callout","none")&&document.body.className.includes("pwa-mode")){let i=j();i&&(e=parseInt(i)-25)}let n=$(this).scrollTop()||0;n<0&&(n=0),d&&n>=e?($("body").addClass("compacted-header"),$(".header-root").addClass("fixed-top"),d=!1):n<e&&!d&&(d=!0,$("body").removeClass("compacted-header"),$(".header-root").removeClass("fixed-top")),$("body")[0].style.setProperty("--page-scroll",String(n)+"px"),$('button[aria-controls="mainNavbar"]').css("margin-top",String(Math.min(n,e)===e?"0":1.5*Math.min(n,e))+"px"),$(".navbar-brand g.first-line").css("opacity",1-Math.min(n,e)/e),$(".navbar-brand g.second-line").css("opacity",1-Math.min(n,e)/e)}).trigger("scroll"),$(".navbar-toggle").on("click",function(){$(".navigation-menu").slideToggle("400")}),$(".back-to-top").on("click",function(){return document.documentElement.scrollTop=0,!1})});function W(){const d=$("body,html");$(".sorter").length&&d.animate({scrollTop:$(".sorter:first").offset().top-100},800)}function I(d){$("body").overhang({custom:!0,message:"<p>"+d+"</p>",primary:"#000000",accent:"#108333",html:!0,easing:"easeOutQuad",speed:100,duration:5})}function P(d="[data-zoneid]"){$(d).reviveAjax({reviveUrl:"//display.automobile.tn/www/delivery/ajs.php"})}class H{constructor(t={}){g(this,"submitButton");g(this,"filtersContainer");g(this,"form");g(this,"initialValues");g(this,"brands",{});g(this,"topBrands",[]);g(this,"countRequest");g(this,"rangeSlider",(t,e)=>{const n=$(t).parents(".field"),i=n.find(".range"),r=i.find(".min"),o=i.find(".max");e=$.extend({snaps:!1,range:!0,change:()=>{this.updateRangeSelection(n),this.filtersContainer.find("input").eq(0).change()},slide:(l,u)=>{let f=e.snaps?e.snaps[u.values[0]]:u.values[0],b=e.snaps?e.snaps[u.values[1]]:u.values[1];r.val(f),o.val(b),this.updateRangeSelection(n)}},e),$(t).slider(e),this.updateRangeSelection(n)});g(this,"bmSelect",(t,e)=>{const n=$(t).find(".selects");let i=$('<select class="form-select" name="brand[]"><option value="">Toutes les marques</option></select>');const r=this.topBrands.filter(o=>this.brands[o]);r.length&&(r.forEach(o=>{i.append($('<option value="'+o+'">'+this.brands[o]+"</option>"))}),i.append($("<option disabled>\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500</option>"))),Object.keys(this.brands).forEach(o=>{i.append($('<option value="'+o+'">'+this.brands[o]+"</option>"))});for(let o=0;o<e;o++){let l=$('<div class="bm bm-'+o+'"'+(o!==0?' style="display: none;"':"")+'"/>');l.append($('<div class="bm-select" />').append(i.clone().on("change",(u,f={})=>{console.log("BM On change",f);let b=$(u.target).parents(".bm-"+o);b.find(".bm-select, .add-row").show(),f.initial||b.find("select[name*=model]").empty().append('<option disabled selected value="">Chargement ...</option>'),this.updateBmSelection(b.parents(".field"))}))),l.append($('<div class="bm-select" style="display: none;"/>').append($('<select class="form-select" name="model[]"><option value="">Chargement ...</option></select>').on("change",u=>{let f=$(u.target).parents(".bm-"+o);this.updateBmSelection(f.parents(".field")),this.fetchCount()}))),o!==e-1&&l.append($('<button class="btn btn-link btn-block add-row">').hide().text("Ajouter des v\xE9hicules").on("click",u=>{let f=$(u.target);return f.parents(".bm").next().show(),f.remove(),u.preventDefault(),!1})),$(n).append(l)}});g(this,"onSubmit",t=>(console.info("onSubmit()"),$(".occasions-results").addClass("loading"),this.form.find("input,select").prop("disabled",!0),$.pjax.submit(t,"#facets-pjax",{push:!0,replace:!1,timeout:5e3,scrollTo:!1,maxCacheLength:0}),t&&t.preventDefault(),!1));g(this,"fetchCount",()=>{console.info("fetchCount()"),this.countRequest&&(console.warn("Canceling previous request"),this.countRequest.abort());const t=this.form.serializeArray();console.info("\u2B06 Fetching count"),this.countRequest=$.post(this.form.attr("action"),t,e=>{this.filtersContainer.find(".count").parents("label").addClass("no-results"),this.filtersContainer.find(".count").text(0),e.url&&(this.form.data("original-action")||(console.log("Original form data",this.form.data("original-action")),this.form.data("original-action",this.form.attr("action")),console.log("Original form data",this.form.data("original-action"))),this.form.attr("action",e.url)),console.info("\u2B07 Received count"),console.dir(e),Object.keys(e.attributes).forEach(n=>{const i=e.attributes[n];if(n==="brand"){const r=t.filter(o=>o.name==="brand[]");for(let o=0;o<r.length;o++){const l=$("select[name*=brand]").eq(o),u=l.val();l.find('option[value!=""]').prop("disabled",!0),Object.keys(i).forEach(f=>{l.find("option[value="+f+"]").text(i[f]).prop("disabled",!1)}),u&&l.val(u)}}else Object.keys(i).forEach(r=>{if(n==="model"){const o=t.filter(l=>l.name==="brand[]");for(let l=0;l<o.length;l++)if(o[l].value===r){const f=$("select[name*=brand]").eq(l).parents(".bm").find("select[name*=model]"),b=f.val();f.find("option").remove(),f.append($('<option value="">Tous les mod\xE8les</option>')),Object.keys(i[r]).forEach(S=>{f.append($('<option value="'+S+'">'+i[r][S]+"</option>"))}),b&&f.val(b)}}else{const o=i[r].match(/ \((\d+)\)$/)[1],l=$("#l-"+n+"-"+r+" .count");l.text()!=o&&l.text(o)}})}),e.sql&&console.log("%c"+e.sql,"color: green;"),this.filtersContainer.find(".count").each((n,i)=>{$(i).parent().toggleClass("no-results",$(i).text()==="0")}),this.countRequest=void 0,this.submitButton.click()})});g(this,"updateAllSelections",()=>{console.info("updateAllSelections()"),this.filtersContainer.find(".field").each((t,e)=>{const n=$(e);n.hasClass("cb")&&this.updateCbSelection(n),n.hasClass("text")&&this.updateTextSelection(n)})});g(this,"updateRangeSelection",t=>{const e=t.find(".slider").slider("option","min"),n=t.find(".slider").slider("option","max"),i=t.find(".slider").slider("option","snaps"),r=t.find(".slider").slider("values");if(r[0]!==e||r[1]!==n){let o=i?i[r[0]]:r[0],l=i?i[r[1]]:r[1];o&&(o+=" "+t.find(".attr-suffix").text()),l&&(l+=" "+t.find(".attr-suffix").text()),t.addClass("have-selection"),o?l?l===o?t.find(".selection").html(`<span class="eq">=</span> ${o}`):t.find(".selection").html(`${o} <i class="fa fa-long-arrow-right"></i> ${l}`):t.find(".selection").html(`<i class="fa fa-chevron-right"></i> ${o}`):t.find(".selection").html(`<i class="fa fa-chevron-left"></i> ${l}`)}});g(this,"updateInlineFilters",()=>{console.info("updateInlineFilters()"),$(".inline-filters .filter").remove(),$(".selection").each(function(t,e){const n=$(e).html().replace(/<li>/g,"<span>").replace(/\s*<\/li>/g,"</span>"),i=$(e).parents(".field").find(".clear-selection");if(n.trim()){const r=$("<li></li>");r.append(n),r.append($('<i class="fa fa-times reset-filter"></i>').on("click",o=>{i.click(),$(o.target).parents("li").remove()})),$(".inline-filters").append(r)}})});g(this,"updateCbSelection",t=>{const e=t.find(".selection");e.empty(),t.removeClass("have-selection"),t.find("input:checked").each((n,i)=>{console.log($(i).parent("label")[0].childNodes[1].nodeValue),e.append($("<li>"+$(i).parent("label")[0].childNodes[1].nodeValue+"</li>")),t.addClass("have-selection")})});g(this,"updateBmSelection",t=>{const e=t.find(".selection");e.empty(),t.removeClass("have-selection"),t.find("select[name^=brand] option:selected").each((n,i)=>{if($(i).val()){const r=$(i).text().replace(/ \((\d+)\)$/,""),o=$(i).parents(".bm").find("select[name^=model] option:selected");o.val()&&o.text()!=="Chargement ..."?e.append($("<li>"+r+" "+o.text().replace(/ \((\d+)\)$/,"")+"</li>")):e.append($("<li>"+r+"</li>")),t.addClass("have-selection")}})});g(this,"updateTextSelection",t=>{const e=t.find(".selection");e.text(t.find("input").val()),t.toggleClass("have-selection",!!e.text().length)});g(this,"clearAllSelections",t=>{if(console.info("clearAllSelections()"),t.type==="keydown"&&t.key!=="Enter"&&t.key!==" ")return;this.unwatchChanges(),this.filtersContainer.find(".field").each((n,i)=>{const r=$(i);r.hasClass("cb")&&this.clearCheckboxSelection(r),r.hasClass("range-slider")&&this.clearRangeSliderSelection(r),r.hasClass("text")&&this.clearTextSelection(r),r.hasClass("bm-select")&&this.clearBmSelection(r),r.find(".selection").empty(),r.removeClass("have-selection")}),this.watchChanges(!0),t.preventDefault();const e=this.form.data("original-action");return e&&this.form.attr("action",e),this.form.submit(),!1});g(this,"clearSelection",t=>{if(t.type==="keydown"&&t.key!=="Enter"&&t.key!==" ")return;const e=$(t.target).parents(".field");this.unwatchChanges(),e.hasClass("cb")&&this.clearCheckboxSelection(e),e.hasClass("range-slider")&&this.clearRangeSliderSelection(e),e.hasClass("text")&&this.clearTextSelection(e),e.hasClass("bm-select")&&this.clearBmSelection(e),e.find(".selection").empty(),e.removeClass("have-selection"),this.watchChanges(!0)});g(this,"setBrands",t=>{this.brands=t});g(this,"setTopBrands",t=>{this.topBrands=t});g(this,"clearTextSelection",t=>{t.find("input").val("")});g(this,"clearBmSelection",t=>{t.find("select").val("")});g(this,"clearCheckboxSelection",t=>{console.log("Clearing CB #"+t.find("input").eq(0).attr("name")),t.find(":checked").prop("checked",!1)});g(this,"clearRangeSliderSelection",t=>{console.log("Clearing RS #"+t.find("input").eq(0).attr("name"));const e=t.find(".slider"),n=e.slider("option");console.log("Options",n.min,n.max),e.slider("values",[n.min,n.max]),t.find(".min").val(""),t.find(".max").val("")});g(this,"unwatchChanges",()=>{this.filtersContainer.find("input").off("change")});g(this,"watchChanges",(t=!1)=>{let e=!1;if(t||(e=!0,Object.keys(this.initialValues).length&&(console.info("Reselecting values"),console.table(this.initialValues),Object.keys(this.initialValues).forEach(n=>{var i;n==="brand"?(i=this.initialValues.brand)==null||i.forEach((r,o)=>{const l=this.filtersContainer.find("select[name*=brand]").eq(o);l.val(r),this.initialValues.model&&this.initialValues.model[o]&&this.filtersContainer.find("select[name*=model]").eq(o).empty().append($('<option value="'+this.initialValues.model[o]+'">'+this.initialValues.model[o].replace(/-/g," ")+"</option>")),l.trigger("change",{initial:!0}),l.parents(".bm").find(".add-row").trigger("click")}):this.filtersContainer.find("[name="+n+"]").val(this.initialValues[n])}),this.filtersContainer.find("input[type=hidden]").remove(),document.location.search.indexOf("expand")===-1&&this.filtersContainer.find(".field").not(".default-on").addClass("off"))),this.filtersContainer.find('input[type="checkbox"]').on("change",n=>this.updateCbSelection($(n.target).parents(".field"))),this.filtersContainer.find(".field.text input").on("change",n=>this.updateTextSelection($(n.target).parents(".field"))),t){const n=()=>this.fetchCount();e?this.filtersContainer.find("input, select").on("change",n):(console.log("dooooone"),this.filtersContainer.find("input, select").on("change",()=>this.fetchCount())),this.filtersContainer.find("input").eq(0).trigger("change"),e&&(this.filtersContainer.find("input, select").off("change",n),this.filtersContainer.find("input, select").on("change",()=>this.fetchCount()))}else this.filtersContainer.find("input, select").on("change",()=>this.fetchCount()),this.updateInlineFilters()});g(this,"toggleField",t=>{if(!(t.type==="keydown"&&t.key!=="Enter"&&t.key!==" "))return $(t.target).parents(".field").toggleClass("off"),t.preventDefault(),!1});this.filtersContainer=$(".occasions-filter"),this.form=this.filtersContainer.find("form"),this.submitButton=this.filtersContainer.find('[type="submit"]'),this.initialValues=t,this.form.on("submit",this.onSubmit),this.filtersContainer.find(".clear-selection").on("click keydown",this.clearSelection),this.filtersContainer.find(".field > span").on("click keydown",this.toggleField),this.filtersContainer.find('[type="reset"]').on("click keydown",this.clearAllSelections),this.filtersContainer.find(".count").each((e,n)=>{$(n).text()==="0"&&$(n).parent().addClass("no-results")}),$(document).on("pjax:success",()=>{this.updateInlineFilters(),P()}),this.updateAllSelections()}}$(function(){$(document).on("click","div.clamped-text > .clamped-text-toggle",function(d){const t=$(d.currentTarget),e=t.prev(),n=e.data("lines"),i=e.data("line-height"),r=e[0].scrollHeight,o=t.parent();o.toggleClass("un-clamped");const l=o.data("ct-show-more")||"Afficher plus",u=o.data("ct-show-less")||"Afficher moins",f=o.data("ct-destruct")||"0";o.hasClass("un-clamped")?(e.css({maxHeight:r}),f!=="0"?t.remove():t.text(u)):(e.css({maxHeight:n*i}),t.text(l))}),L()});function L(){const d=$("div.clamped-text");d.length&&d.each((t,e)=>{const n=$(e).find("> div.text"),i=n.css("max-height");let r=n.css("max-height","none").height();r||(r=0),n.css("max-height",i),r>parseInt(i)&&n.parent().find(".clamped-text-toggle").show()})}N.register("modules/imageUploader",V);class A{static removeComment(t){return yii.confirm("\xCAtes-vous certain de vouloir supprimer ce commentaire ?",function(){$.post({url:`/fr/comments/delete?id=${t}`,success:e=>{$(`#comment-${t}`).html(e)},error:e=>{$(`#comment-${t}`).html(`<div class='text-center text-muted'><i>${e.statusText}</i></div>`)}})}),!1}static bindForm(){$(document).on("submit",".comment-form",function(t){t.preventDefault();const e=$(this),i=new URL("http://foobar"+e.attr("action")).searchParams.get("reply_to");return $.ajax({url:e.attr("action"),type:"post",data:e.serialize(),success:function(r){const o=$("<div />").html(r).find(".comment");o.hide();const l=o.attr("id"),u=$("#comments").find(`#${l}`);if(u.length)u.html(o.html());else{if(i){const f=$("#comment-"+i);o.insertAfter(f)}else $("#comments").prepend(o);o.fadeIn("slow",function(){$("html, body").animate({scrollTop:o.offset().top-100},100,()=>{o.addClass("comments-flash"),setTimeout(()=>{o.removeClass("comments-flash")},2e3)})}),e[0].reset(),$(e).find(".ql-container")[0].quill.setContents([]),$(e).parents(".post-reply").html("")}L()}}),!1})}static replyTo(t,e){return $.get({url:`/fr/comments/new?thread_id=${t}&reply_to=${e}`,success:n=>{const i=Date.now();$(`#comment-${e}`).find(".post-reply").html(n.replace("comment-reply","comment-reply-"+i)),A.registerEditor(`.comment-reply-${i}`,t,e),$(`#comment-${e}`).find(".post-reply").show()},error:n=>{$(`#comment-${e}`).html(`<div class='text-center text-muted'><i>${n.statusText}</i></div>`)}}),!1}static editComment(t,e){const n=$(`#comment-${e} .post-body`).html();return $.get({url:`/fr/comments/edit?thread_id=${t}&comment_id=${e}`,success:i=>{$(`#comment-${e} .post-body .clamped-text .text`).length>0?A.registerEditor(`#comment-${e} .post-body .clamped-text .text`,t,e):A.registerEditor(`#comment-${e} .post-body`,t,e);const r=$(`#comment-${e}`),o=Date.now();r.find(".post-reply").hide().html(i.replace("comment-edit","comment-edit-"+o)),r.find(".post-edit-buttons").removeClass("d-none"),r.find(".post-actions > ul").hide(),r.find(".btn-edit-cancel").on("click",()=>{$(`#comment-${e} .post-body`).html(n),r.find(".post-reply"),r.find(".ql-toolbar").remove(),r.find(".post-body").removeClass("ql-container ql-snow"),r.find(".post-edit-buttons").addClass("d-none"),r.find(".post-actions > ul").show()})},error:i=>{$(`#comment-${e}`).html(`<div class='text-center text-muted'><i>${i.statusText}</i></div>`)}}),!1}static registerEditor(t,e,n){const i=new N(t,{formats:["blockquote","image","imageBlot","video","link","text"],modules:{toolbar:[["link","blockquote","image","video"]],imageUploader:{upload:l=>new Promise((u,f)=>{const b=new FormData;b.append("file",l),b.append("threadId",String(e)),$.ajax({url:"/fr/comments/media",type:"POST",data:b,contentType:!1,processData:!1,success:function(S){u(S)},error:function(S,w){f(w)}})})}},placeholder:"Saisissez votre message",theme:"snow"});function r(){const l=i.getContents().ops;let u=i.getText().trim();u||l.forEach(f=>{f.insert&&f.insert.image&&(u="1")}),$(`${n?`#comment-${n}`:".new-comment"} .field-commentform-body input`).val(u?JSON.stringify(l):""),$(`${n?`#comment-${n}`:".new-comment"} .field-editcommentform-body input`).val(u?JSON.stringify(l):"")}i.on("text-change",r),i.getModule("toolbar").addHandler("video",()=>{let l=prompt("Saisissez l'URL de la vid\xE9o: ");if(!l)return;l=o(l);let u=i.getSelection();l!=null&&i.insertEmbed(u,"video",l)});function o(l){let u=l.match(/^(?:(https?):\/\/)?(?:(?:www|m)\.)?youtube\.com\/watch.*v=([a-zA-Z0-9_-]+)/)||l.match(/^(?:(https?):\/\/)?(?:(?:www|m)\.)?youtu\.be\/([a-zA-Z0-9_-]+)/)||l.match(/^.*(youtu.be\/|v\/|e\/|u\/\w+\/|embed\/|v=)([^#\&\?]*).*/);return u&&u[2].length===11?"https://www.youtube.com/embed/"+u[2]+"?showinfo=0":(u=l.match(/^(?:(https?):\/\/)?(?:www\.)?vimeo\.com\/(\d+)/),u?(u[1]||"https")+"://player.vimeo.com/video/"+u[2]+"/":null)}$(t)[0].quill=i}}(function(d){const t=document.location.hostname!=="www.automobile.tn";if((!window.console||!d)&&(d={}),d.clear(),!t){d.log(`%c
                       ___..............._
             __.. ' _'.""""""\\\\""""""""- .\`-._
 ______.-'         (_) |      \\\\           \` \\\\\`-. _
/_       --------------'-------\\\\---....______\\\\__\`.\`  -..___
| T      _.----._           Xxx|x...           |          _.._\`--. _
| |    .' ..--.. \`.         XXX|XXXXXXXXXxx==  |       .'.---..\`.     -._
\\_j   /  /  __  \\  \\        XXX|XXXXXXXXXXX==  |      / /  __  \\ \\        \`-.
 _|  |  |  /  \\  |  |       XXX|""'            |     / |  /  \\  | |          |
|__\\_j  |  \\__/  |  L__________|_______________|_____j |  \\__/  | L__________J
     \`'\\ \\      / ./__________________________________\\ \\      / /___________\\
        \`.\`----'.'                                     \`.\`----'.'
          \`""""'                                         \`""""'`,"color: #d90000"),d.log(`%cBienvenue sur AUTOMOBILE.TN!

Vous avez trouv\xE9 un bug ou une faille de s\xE9curit\xE9 ? \u{1F631}
Soyez constructifs, contactez-nous! \u2764\uFE0F
\u{1F4E9} ${document.location.origin}/fr/contact`,"font-size: 14px; line-height: 20px;");const e=function(){};window.console={log:e,dir:e,warn:e,error:e,info:e,table:e}}})(window.console);$(()=>{$(".more_photos").on("click",o=>(o.stopPropagation(),$(".inactive-pic").each((l,u)=>{$(u).removeClass("inactive-pic")}),$(".more_photos").hide().off("click").removeClass("more_photos"),$(".grid-gallery").masonry({itemSelector:".grid-item"}),!1));const d=new Image;let t=!1;const e=o=>o.replace(".jpg",".webp").replace(".jpeg",".webp").replace(".png",".webp");function n(o){t=typeof o=="object"&&o.type==="load"?d.width===1:!1,t&&$("a.grid-item").each((l,u)=>{$(u).attr("href",e($(u).attr("href"))),$(u).attr("data-thumb",e($(u).data("thumb")))})}d.onerror=n,d.onload=n,d.src="data:image/webp;base64,UklGRiQAAABXRUJQVlA4IBgAAAAwAQCdASoBAAEAAwA0JaQAA3AA/vuUAAA=",B.bind("[data-fancybox^=embedded-gallery]",{idle:!1,compact:!1,dragToClose:!0,animated:!1,showClass:"f-fadeSlowIn",hideClass:!1,Carousel:{infinite:!1},Images:{zoom:!1,Panzoom:{maxScale:1.5}},Toolbar:{absolute:!0,display:{left:["infobar"],middle:[],right:["iterateZoom","slideshow","close"]}},Slideshow:{timeout:5e3},Thumbs:{showOnStart:!1}}),B.bind('[data-fancybox="gallery"]',{idle:!1,compact:!1,dragToClose:!0,animated:!1,showClass:"f-fadeSlowIn",hideClass:!1,Carousel:{infinite:!1},Images:{zoom:!1,Panzoom:{maxScale:1.5}},Toolbar:{absolute:!0,display:{left:["infobar"],middle:[],right:["iterateZoom","slideshow","thumbs","close"]}},Slideshow:{timeout:5e3},Thumbs:{type:"classic",showOnStart:!1,Carousel:{axis:"x",slidesPerPage:1,Navigation:!0,center:!0,fill:!0,dragFree:!0,breakpoints:{"(min-width: 640px)":{axis:"y"}}}}});const i=$(".grid-gallery").masonry({itemSelector:".grid-item"}).imagesLoaded().progress(function(){i.masonry("layout")}),r=document.getElementById("occasionCarousel");r&&new U(r,{infinite:!1,Dots:!1,Thumbs:{type:"classic"}},{Thumbs:X})});$(function(){$(".home-search-widget .tabs a").on("click",function(){return $(".home-search-widget .tabs a").removeClass("active"),$(this).addClass("active"),$(".home-search-widget .occasions").toggle($(this).hasClass("occasion")),$(".home-search-widget .versions").toggle($(this).hasClass("neuf")),!1})});function J(){const d=o=>{$("#"+o).fadeIn(300,function(){const l=document.getElementById(o);if(!l)return;const u=l.getBoundingClientRect().top+window.scrollY-100;window.scrollTo({top:u,behavior:"smooth"})})},t=o=>{$("#"+o).empty().hide()};function e(){const o=$("#occasionform-model_id").val(),l=$("#occasionform-date_mc").val(),u=$('[name="OccasionForm[designation]"]:checked').val(),f=$("#attr-53 option:selected").text(),b=$("#attr-50 option:selected").text();if(!o||!l||!f||!b){console.log("missing stuff");return}const S={model_id:o,date_mc:l,gearbox:f,energy:b,designation:u},w=$('[name="OccasionForm[trim_id]"]:checked').val();$.get("/fr/mon-espace/get-trims",S,function(v){const x=$("#finition");x.empty(),v.length&&v.forEach(function(m){x.append($("<input "+(w&&w==m.id?" checked ":"")+' type="radio" data-matched="'+(m.matched?1:0)+'" class="btn-check" name="OccasionForm[trim_id]" id="trim-'+m.id+'" autocomplete="off" value="'+m.id+'">')),x.append($('<label class="btn btn-outline-secondary" style="'+(m.matched?"":"display:none")+'" data-matched="'+(m.matched?1:0)+'" for="trim-'+m.id+'">'+(m.matched?"\u2705":"")+" "+m.name+"</label>"))});const T=$('<button type="button">Afficher plus..</button>').on("click",function(){$('#finition [data-matched="0"]').show(),$(this).hide()});x.append(T),v.filter(m=>m.matched).length===0&&(T.trigger("click"),v.length===0?($("#trim-0").trigger("click"),$('label[for="trim-0"]').hide()):$('label[for="trim-0"]').show()),d("finition-section")})}$(document).on("change",'[name="OccasionForm[origin]"]',function(){console.log("ici");const o=$(this).val(),l=$("#occasionform-model_id").val(),u=$('[name="OccasionForm[trim_id]"]:checked').val(),f=$("#occasionform-date_mc").val(),b=$("#attr-53 option:selected").text(),S=$("#attr-50 option:selected").text(),w={model_id:l,date_mc:f,gearbox:b,energy:S,trim_id:u};console.table(w),o==="tn"?($.get("/fr/mon-espace/get-designations",w,function(v){const x=$("#versions");if(x.empty(),v&&Object.entries(v).length>0){Object.entries(v).forEach(function([m,{name:_,matched:s}]){x.append($('<input type="radio" data-matched="'+(s?1:0)+'" class="btn-check" name="OccasionForm[designation]" id="designation-'+m+'" autocomplete="off" value="'+m+'">')),x.append($('<label class="btn btn-outline-secondary" style="'+(s?"":"display:none")+'" data-matched="'+(s?1:0)+'" for="designation-'+m+'">'+(s?"\u2705":"")+" "+_+"</label>"))});const T=$('<button type="button">Afficher plus..</button>').on("click",function(){$('#versions [data-matched="0"]').show(),$(this).hide()});x.append(T),Object.values(v).filter(m=>m.matched).length===0&&T.trigger("click"),Object.values(v).filter(m=>!m.matched).length===0&&T.hide(),$("#versions").show(),d("bloc-versions")}else n()}),t("tecdoc"),t("tecdocm"),$("#bloc-tecdoc").hide(),$("#tecdocm-section").hide()):(t("versions"),$("#bloc-versions").hide(),n())});function n(){const o=$("#occasionform-model_id").val(),l=$('[name="OccasionForm[trim_id]"]:checked').val(),u=$("#occasionform-date_mc").val(),f=$("#attr-53 option:selected").text(),b=$("#attr-50 option:selected").text(),S={model_id:o,date_mc:u,gearbox:f,energy:b,trim_id:l};$.get("/fr/mon-espace/get-tec-doc",S,function(w){console.log("TECDOC"),console.log(w.ret);const v=$("#tecdoc"),x=$("#tecdocm");v.empty(),x.empty(),!Array.isArray(w.ret)&&Object.keys(w.ret).length?(Object.entries(w.ret).forEach(function([T,m]){console.log(T,m),v.append($('<input type="radio" class="btn-check" name="OccasionForm[tecdoc_model_id]" id="om-'+m.id+'" autocomplete="off" value="'+m.id+'">')),v.append($('<label class="btn btn-outline-secondary" for="om-'+m.id+'">'+m.name+"</label>")),console.log("types",m.types),m.types.forEach(function(_){x.append($('<input type="radio" data-tecdoc-model="'+m.id+'" class="btn-check" name="OccasionForm[tecdoc_type_id]" id="ot-'+_.id+'" autocomplete="off" value="'+_.id+'">')),x.append($('<label class="btn btn-outline-secondary" data-tecdoc-model="'+m.id+'"  for="ot-'+_.id+'">'+_.name.replace("Bo\xEEte auto","")+"</label>"))})}),$("#tecdoc").show(),d("bloc-tecdoc")):e()})}function i(){const o=$("#occasionform-model_id").val(),l=$('[name="OccasionForm[trim_id]"]:checked').val(),u=$("#occasionform-date_mc").val(),f=$("#attr-53 option:selected").text(),b=$("#attr-50 option:selected").text(),S=$('[name="OccasionForm[version_id]"]:checked').val(),w=$('[name="OccasionForm[designation]"]:checked').val(),v=$('[name="OccasionForm[tecdoc_model_id]"]:checked').val(),x=$('[name="OccasionForm[tecdoc_type_id]"]:checked').val(),T={model_id:o,date_mc:u,gearbox:f,energy:b,trim_id:l,version_id:S,designation:w,tecdoc_model_id:v,tecdoc_type_id:x};$.get("/fr/mon-espace/get-specs",T,function(m){m.predefined&&m.predefined.forEach(_=>{const s=$(`select option[value=${_}]`);if(s.length===1){$(s.parent().val(_));return}const a=$(`input[type=checkbox][value=${_}]`);a.length===1&&a.prop("checked",!0)}),m.values&&Object.entries(m.values).forEach(([_,s])=>{$("#attr-"+_).val(s)}),m.labels&&Object.entries(m.labels).map(([_,s])=>{const a=$(`#attr-${_}`);if(a[0].nodeName==="SELECT"){const c=$(`#attr-${_} option:contains("${s}")`).val();c&&a.val(c)}else a.val(s)}),d("history-section")})}$(document).on("change",'[name="OccasionForm[designation]"]',e),$(document).on("change",'[name="OccasionForm[version_id]"]',i),$(document).on("change",'[name="OccasionForm[trim_id]"]',function(){$(this).val()==="0"?d("manual-finition"):($("#manual-finition").hide(),$("#occasionform-finition").val(""),i())}),$(document).on("change",'[name="OccasionForm[tecdoc_model_id]"]',function(){const o=$(this).val();$("[data-tecdoc-model]").hide(),$("[data-tecdoc-model="+o+"]").show(),$("#tecdocm-section").show(),d("tecdocm")}),$(document).on("change",'[name="OccasionForm[tecdoc_type_id]"]',e);function r(o,l){l.forEach(u=>{o.yiiActiveForm("validateAttribute",u)})}$(".section-next").on("click",async o=>{var b;const l=o.target;l.textContent="...";const u=$(l).parents("form");u.on("afterValidateAttribute",function(S,w,v){console.log("afterValidateAttribute",S,w,v)});const f=(b=l.dataset.fields)==null?void 0:b.split(",");r(u,f),setTimeout(()=>{$(l).parents(".secondary-container").find(".is-invalid").length>0?l.textContent="Corriger":(l.textContent="Suivant",d(`${l.dataset.section}-section`))},300)}),document.location.pathname.includes("editer")&&($("div[id$='section']").show(),$(".section-next").hide())}$(function(){$("select.model-selector.brand").on("change",function(d){const t=$(d.currentTarget),e=t.val(),n='select[data-models-for="'+t.attr("id")+'"]',i=$(n),r=t.data("prompt");i.find("option").remove(),i.append('<option value="">'+r+"</option>"),e&&(i.find("option").remove(),i.append('<option value="">Loading..</option>'),i.prop("disabled","disabled"),$.post(t.data("url"),{brandSlug:e,stand:t.data("stand"),mapToId:i.data("map-to-id")},function(o){i.find("option").remove(),i.prop("disabled",!1),i.append('<option value="">'+r+"</option>");for(let l=0;l<o.length;l++)i.append('<option value="'+o[l].id+'">'+o[l].name+"</option>");i.trigger("chosen:updated")}))}).chosen(),$("select.model-selector.model").on("change",function(d){const t=$(d.currentTarget),e=t.val(),n=$("#"+t.data("models-for")),i='select[data-versions-for="'+t.data("models-for")+'"]',r=$(i);r.find("option").remove(),r.append('<option value="">'+t.data("prompt")+"</option>"),e&&$.post(t.data("url"),{brandSlug:n.val(),modelSlug:e,stand:t.data("stand")},function(o){for(let l=0;l<o.length;l++)r.append('<option value="'+o[l].id+'">'+o[l].name+"</option>");r.trigger("chosen:updated")})}).chosen(),$("select.version").chosen()});$(function(){$(".check-all").on("click",function(){return $("#"+$(this).data("for")).find('input[type="checkbox"]').each(function(t,e){e.checked=!e.checked}),!1})});(function(){if(typeof window!="object")return;if("IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype){"isIntersecting"in window.IntersectionObserverEntry.prototype||Object.defineProperty(window.IntersectionObserverEntry.prototype,"isIntersecting",{get:function(){return this.intersectionRatio>0}});return}function d(s){try{return s.defaultView&&s.defaultView.frameElement||null}catch{return null}}var t=function(s){for(var a=s,c=d(a);c;)a=c.ownerDocument,c=d(a);return a}(window.document),e=[],n=null,i=null;function r(s){this.time=s.time,this.target=s.target,this.rootBounds=x(s.rootBounds),this.boundingClientRect=x(s.boundingClientRect),this.intersectionRect=x(s.intersectionRect||v()),this.isIntersecting=!!s.intersectionRect;var a=this.boundingClientRect,c=a.width*a.height,h=this.intersectionRect,p=h.width*h.height;c?this.intersectionRatio=Number((p/c).toFixed(4)):this.intersectionRatio=this.isIntersecting?1:0}function o(s,a){var c=a||{};if(typeof s!="function")throw new Error("callback must be a function");if(c.root&&c.root.nodeType!=1)throw new Error("root must be an Element");this._checkForIntersections=u(this._checkForIntersections.bind(this),this.THROTTLE_TIMEOUT),this._callback=s,this._observationTargets=[],this._queuedEntries=[],this._rootMarginValues=this._parseRootMargin(c.rootMargin),this.thresholds=this._initThresholds(c.threshold),this.root=c.root||null,this.rootMargin=this._rootMarginValues.map(function(h){return h.value+h.unit}).join(" "),this._monitoringDocuments=[],this._monitoringUnsubscribes=[]}o.prototype.THROTTLE_TIMEOUT=100,o.prototype.POLL_INTERVAL=null,o.prototype.USE_MUTATION_OBSERVER=!0,o._setupCrossOriginUpdater=function(){return n||(n=function(s,a){!s||!a?i=v():i=T(s,a),e.forEach(function(c){c._checkForIntersections()})}),n},o._resetCrossOriginUpdater=function(){n=null,i=null},o.prototype.observe=function(s){var a=this._observationTargets.some(function(c){return c.element==s});if(!a){if(!(s&&s.nodeType==1))throw new Error("target must be an Element");this._registerInstance(),this._observationTargets.push({element:s,entry:null}),this._monitorIntersections(s.ownerDocument),this._checkForIntersections()}},o.prototype.unobserve=function(s){this._observationTargets=this._observationTargets.filter(function(a){return a.element!=s}),this._unmonitorIntersections(s.ownerDocument),this._observationTargets.length==0&&this._unregisterInstance()},o.prototype.disconnect=function(){this._observationTargets=[],this._unmonitorAllIntersections(),this._unregisterInstance()},o.prototype.takeRecords=function(){var s=this._queuedEntries.slice();return this._queuedEntries=[],s},o.prototype._initThresholds=function(s){var a=s||[0];return Array.isArray(a)||(a=[a]),a.sort().filter(function(c,h,p){if(typeof c!="number"||isNaN(c)||c<0||c>1)throw new Error("threshold must be a number between 0 and 1 inclusively");return c!==p[h-1]})},o.prototype._parseRootMargin=function(s){var a=s||"0px",c=a.split(/\s+/).map(function(h){var p=/^(-?\d*\.?\d+)(px|%)$/.exec(h);if(!p)throw new Error("rootMargin must be specified in pixels or percent");return{value:parseFloat(p[1]),unit:p[2]}});return c[1]=c[1]||c[0],c[2]=c[2]||c[0],c[3]=c[3]||c[1],c},o.prototype._monitorIntersections=function(s){var a=s.defaultView;if(!!a&&this._monitoringDocuments.indexOf(s)==-1){var c=this._checkForIntersections,h=null,p=null;if(this.POLL_INTERVAL?h=a.setInterval(c,this.POLL_INTERVAL):(f(a,"resize",c,!0),f(s,"scroll",c,!0),this.USE_MUTATION_OBSERVER&&"MutationObserver"in a&&(p=new a.MutationObserver(c),p.observe(s,{attributes:!0,childList:!0,characterData:!0,subtree:!0}))),this._monitoringDocuments.push(s),this._monitoringUnsubscribes.push(function(){var y=s.defaultView;y&&(h&&y.clearInterval(h),b(y,"resize",c,!0)),b(s,"scroll",c,!0),p&&p.disconnect()}),s!=(this.root&&this.root.ownerDocument||t)){var C=d(s);C&&this._monitorIntersections(C.ownerDocument)}}},o.prototype._unmonitorIntersections=function(s){var a=this._monitoringDocuments.indexOf(s);if(a!=-1){var c=this.root&&this.root.ownerDocument||t,h=this._observationTargets.some(function(y){var E=y.element.ownerDocument;if(E==s)return!0;for(;E&&E!=c;){var k=d(E);if(E=k&&k.ownerDocument,E==s)return!0}return!1});if(!h){var p=this._monitoringUnsubscribes[a];if(this._monitoringDocuments.splice(a,1),this._monitoringUnsubscribes.splice(a,1),p(),s!=c){var C=d(s);C&&this._unmonitorIntersections(C.ownerDocument)}}}},o.prototype._unmonitorAllIntersections=function(){var s=this._monitoringUnsubscribes.slice(0);this._monitoringDocuments.length=0,this._monitoringUnsubscribes.length=0;for(var a=0;a<s.length;a++)s[a]()},o.prototype._checkForIntersections=function(){if(!(!this.root&&n&&!i)){var s=this._rootIsInDom(),a=s?this._getRootRect():v();this._observationTargets.forEach(function(c){var h=c.element,p=w(h),C=this._rootContainsTarget(h),y=c.entry,E=s&&C&&this._computeTargetAndRootIntersection(h,p,a),k=c.entry=new r({time:l(),target:h,boundingClientRect:p,rootBounds:n&&!this.root?null:a,intersectionRect:E});y?s&&C?this._hasCrossedThreshold(y,k)&&this._queuedEntries.push(k):y&&y.isIntersecting&&this._queuedEntries.push(k):this._queuedEntries.push(k)},this),this._queuedEntries.length&&this._callback(this.takeRecords(),this)}},o.prototype._computeTargetAndRootIntersection=function(s,a,c){if(window.getComputedStyle(s).display!="none"){for(var h=a,p=_(s),C=!1;!C&&p;){var y=null,E=p.nodeType==1?window.getComputedStyle(p):{};if(E.display=="none")return null;if(p==this.root||p.nodeType==9)if(C=!0,p==this.root||p==t)n&&!this.root?!i||i.width==0&&i.height==0?(p=null,y=null,h=null):y=i:y=c;else{var k=_(p),R=k&&w(k),D=k&&this._computeTargetAndRootIntersection(k,R,c);R&&D?(p=k,y=T(R,D)):(p=null,h=null)}else{var F=p.ownerDocument;p!=F.body&&p!=F.documentElement&&E.overflow!="visible"&&(y=w(p))}if(y&&(h=S(y,h)),!h)break;p=p&&_(p)}return h}},o.prototype._getRootRect=function(){var s;if(this.root)s=w(this.root);else{var a=t.documentElement,c=t.body;s={top:0,left:0,right:a.clientWidth||c.clientWidth,width:a.clientWidth||c.clientWidth,bottom:a.clientHeight||c.clientHeight,height:a.clientHeight||c.clientHeight}}return this._expandRectByRootMargin(s)},o.prototype._expandRectByRootMargin=function(s){var a=this._rootMarginValues.map(function(h,p){return h.unit=="px"?h.value:h.value*(p%2?s.width:s.height)/100}),c={top:s.top-a[0],right:s.right+a[1],bottom:s.bottom+a[2],left:s.left-a[3]};return c.width=c.right-c.left,c.height=c.bottom-c.top,c},o.prototype._hasCrossedThreshold=function(s,a){var c=s&&s.isIntersecting?s.intersectionRatio||0:-1,h=a.isIntersecting?a.intersectionRatio||0:-1;if(c!==h)for(var p=0;p<this.thresholds.length;p++){var C=this.thresholds[p];if(C==c||C==h||C<c!=C<h)return!0}},o.prototype._rootIsInDom=function(){return!this.root||m(t,this.root)},o.prototype._rootContainsTarget=function(s){return m(this.root||t,s)&&(!this.root||this.root.ownerDocument==s.ownerDocument)},o.prototype._registerInstance=function(){e.indexOf(this)<0&&e.push(this)},o.prototype._unregisterInstance=function(){var s=e.indexOf(this);s!=-1&&e.splice(s,1)};function l(){return window.performance&&performance.now&&performance.now()}function u(s,a){var c=null;return function(){c||(c=setTimeout(function(){s(),c=null},a))}}function f(s,a,c,h){typeof s.addEventListener=="function"?s.addEventListener(a,c,h||!1):typeof s.attachEvent=="function"&&s.attachEvent("on"+a,c)}function b(s,a,c,h){typeof s.removeEventListener=="function"?s.removeEventListener(a,c,h||!1):typeof s.detatchEvent=="function"&&s.detatchEvent("on"+a,c)}function S(s,a){var c=Math.max(s.top,a.top),h=Math.min(s.bottom,a.bottom),p=Math.max(s.left,a.left),C=Math.min(s.right,a.right),y=C-p,E=h-c;return y>=0&&E>=0&&{top:c,bottom:h,left:p,right:C,width:y,height:E}||null}function w(s){var a;try{a=s.getBoundingClientRect()}catch{}return a?(a.width&&a.height||(a={top:a.top,right:a.right,bottom:a.bottom,left:a.left,width:a.right-a.left,height:a.bottom-a.top}),a):v()}function v(){return{top:0,bottom:0,left:0,right:0,width:0,height:0}}function x(s){return!s||"x"in s?s:{top:s.top,y:s.top,bottom:s.bottom,left:s.left,x:s.left,right:s.right,width:s.width,height:s.height}}function T(s,a){var c=a.top-s.top,h=a.left-s.left;return{top:c,left:h,height:a.height,width:a.width,bottom:c+a.height,right:h+a.width}}function m(s,a){for(var c=a;c;){if(c==s)return!0;c=_(c)}return!1}function _(s){var a=s.parentNode;return s.nodeType==9&&s!=t?d(s):a&&a.nodeType==11&&a.host?a.host:a&&a.assignedSlot?a.assignedSlot.parentNode:a}window.IntersectionObserver=o,window.IntersectionObserverEntry=r})();function K(d,t){const e=$(d);return e.owlCarousel({loop:!0,autoplay:!0,autoplaySpeed:1e3,autoplayHoverPause:!0,margin:50,responsiveClass:!0,items:4,responsive:{0:{items:1},576:{items:2},768:{items:3},992:{items:4}},nav:!0,navText:['<i class="fa fa-caret-left"></i>','<i class="fa fa-caret-right"></i>'],dots:!1,...t}),$("button.owl-prev").attr("aria-label","Previous"),$("button.owl-next").attr("aria-label","Next"),window.addEventListener("resize",function(){e.trigger("next.owl.carousel"),e.trigger("prev.owl.carousel")},!0),e}class Q{constructor(t={onLabel:"Comparer",offLabel:"Comparer"}){g(this,"config");this.config=t,$(document).on("click",".comparable",e=>{const n=$(e.target),i=$(n).data("present"),r=$(n).data("id"),o=$(n).attr("href");if(console.dir(i),i==1){const l=o+"?mode=del&id="+r;$.post(l,()=>{$(n).text(this.config.onLabel),I('V\xE9hicule supprim\xE9 du <a href="'+o+'"><u>comparateur</u></a>'),$(n).data("present",0)})}else{const l=o+"?mode=add&id="+r;$.post(l,()=>{$(n).text(this.config.offLabel),I('V\xE9hicule ajout\xE9 au <a href="'+o+'"><u>comparateur</u></a>'),$(n).data("present",1)})}return console.log("Clicked",i,r,$(e)),e.preventDefault(),!1})}}class Y{constructor(t,e,n="/web-push",i=1e3*60*10){g(this,"appId");g(this,"publicKey");g(this,"controller");g(this,"LS",{ENDPOINT:"yii2-wpn-endpoint",LAST_SYNC:"yii2-wpn-last_sync"});g(this,"syncInterval");this.appId=t,this.publicKey=e,this.controller=n,this.syncInterval=i}setupRegistration(t="/sw.js",e=r=>{},n=r=>{},i=r=>!1){if("serviceWorker"in navigator)if("PushManager"in window)if("showNotification"in ServiceWorkerRegistration.prototype){if(Notification.permission==="denied")return this.log("Notifications are denied by the user"),!1}else return this.log("Notifications are not supported by this browser"),!1;else return this.log("Push notifications are not supported by this browser"),!1;else return this.log("Service workers are not supported by this browser"),!1;navigator.serviceWorker.register(t).then(()=>{const r=parseInt(localStorage.getItem(this.LS.LAST_SYNC)||""),o=Date.now();(!r||o-r>this.syncInterval)&&(console.log(o,r,o-r,this.syncInterval),this.checkSubscription(e,n,i),localStorage.setItem(this.LS.LAST_SYNC,String(o)))},r=>{this.log("ServiceWorker registration failed: ",r)})}checkSubscription(t=i=>{},e=i=>{},n=i=>!1){navigator.serviceWorker.ready.then(i=>i.pushManager.getSubscription()).then(i=>{if(!i){t("unsubscribed");return}return n(this)?i.unsubscribe().then(()=>navigator.serviceWorker.ready).then(r=>r.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:this.urlBase64ToUint8Array(this.publicKey)})).then(r=>this.sync(r,"POST")):this.sync(i,"PUT")}).then(i=>i&&t("subscribed")).catch(i=>{this.log("Error when updating the subscription",i),e(i)})}subscribe(t=n=>{},e=n=>{}){return this.checkNotificationPermission().then(()=>navigator.serviceWorker.ready).then(n=>n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:this.urlBase64ToUint8Array(this.publicKey)})).then(n=>(localStorage.setItem(this.LS.ENDPOINT,n.endpoint),this.sync(n,"POST"))).then(n=>t(n)).catch(n=>{Notification.permission==="denied"?e("Notifications are denied by the user."):e("Impossible to subscribe to push notifications : "+n)})}unsubscribe(t=()=>{},e=()=>{}){navigator.serviceWorker.ready.then(n=>n.pushManager.getSubscription()).then(n=>{if(!n){t();return}return this.sync(n,"DELETE")}).then(n=>n==null?void 0:n.unsubscribe()).then(()=>{localStorage.removeItem(this.LS.ENDPOINT),t()}).catch(n=>{this.log("Error when unsubscribing the user",n),e()})}sync(t,e){const n=(PushManager.supportedContentEncodings||["aesgcm"])[0];return localStorage.setItem(this.LS.ENDPOINT,t.endpoint),new Promise((i,r)=>{$.ajax({url:`${this.controller}/sync?appId=${this.appId}`,type:e,data:JSON.stringify({endpoint:t.endpoint,publicKey:this.encode(t.getKey("p256dh")),authToken:this.encode(t.getKey("auth")),contentEncoding:n,...this.getCsrfParams()}),success:()=>{i(t)},error:o=>{this.log("WPN Sync error: ",o),r(o)}})})}checkNotificationPermission(){return new Promise((t,e)=>Notification.permission==="denied"?e(new Error("Push messages are blocked.")):Notification.permission==="granted"?t():Notification.permission==="default"?Notification.requestPermission().then(n=>{console.log({result:n}),n!=="granted"?e(new Error("Bad permission result: "+n.toString())):t()}):e(new Error("Unknown permission")))}urlBase64ToUint8Array(t){const e="=".repeat((4-t.length%4)%4),n=(t+e).replace(/\-/g,"+").replace(/_/g,"/"),i=window.atob(n),r=new Uint8Array(i.length);for(let o=0;o<i.length;++o)r[o]=i.charCodeAt(o);return r}getCsrfParams(){return{[jQuery("meta[name=csrf-param]").attr("content")]:jQuery("meta[name=csrf-token]").attr("content")}}encode(t){return t?btoa(String.fromCharCode.apply(null,new Uint8Array(t))):null}log(...t){console.log(...t)}}window.Comparator=Q;window.Facets=H;window.OccasionForm=J;window.WebPush=Y;window.carousel=K;window.refreshAds=P;window.showSuccess=I;window.scrollToPagination=W;window.touchClampedText=L;const O=document.getElementById("mainNavbar");O==null||O.addEventListener("hidden.bs.offcanvas",()=>{document.documentElement.style.overflow="auto"});O==null||O.addEventListener("shown.bs.offcanvas",()=>{document.documentElement.style.overflow="hidden"});$(()=>{$(".cta.cta-share").on("click",function(){const n=document.title||"Automobile.tn";let i=document.location.href,r=document.querySelector("link[rel=canonical]");r!==null&&(i=r.href),navigator.share?navigator.share({title:n,url:i}):console.log("not compatible")});const d=document.querySelector(".btn-main-phone");if(d&&new IntersectionObserver(function(i){var r,o;i[0].intersectionRatio===0?(r=document.querySelector(".floating-infos"))==null||r.classList.remove("hide"):i[0].intersectionRatio===1&&((o=document.querySelector(".floating-infos"))==null||o.classList.add("hide"))},{threshold:[0,1]}).observe(d),$.ajaxSetup({headers:{"X-CSRF-Token":yii.getCsrfToken()}}),[...document.querySelectorAll('[data-bs-toggle="tooltip"]')].map(n=>new z.Tooltip(n,{popperConfig:{placement:"top-end"}})),window.caches){const n=Array.prototype.slice.call(document.querySelectorAll("img[data-src]"));Promise.all(n.map(i=>{const r=i.getAttribute("data-src");return window.caches.match(r).then(o=>{o&&(i.setAttribute("src",r),i.setAttribute("alt",i.getAttribute("data-alt")),i.removeAttribute("data-src"),i.removeAttribute("data-alt"))})})).then(e)}else e();function e(){lazySizes.init()}$(".occasions-filter legend").on("click",function(){return $(this).toggleClass("open"),$(".fields").slideToggle("fast"),!1}),$("div.occasions-filter form, .home-search-widget form, .search-engine-widget form").on("submit",function(){$(this).find("select:not(.model-selector), input").filter(function(){return!$.trim($(this).val()).length}).prop("disabled",!0),$(document).on("pjax:complete",function(){$(this).find("select, input").prop("disabled",!1)})}),$(document).on("click",".mobile-filter",()=>($(".occasions-filter").slideToggle(()=>{var n;(n=document.getElementById("super_content_container"))==null||n.scrollIntoView()}).toggleClass("visible"),$("body").toggleClass("filters-visible"),!1)),$(document).on("click",".mobile-show-results",()=>($(".occasions-filter").removeClass("visible").css("display",""),$("body").removeClass("filters-visible"),!1)),$(document).on("click",".format a",function(){return $.ajax($(this).attr("href")).always(function(){const n=$(".occasions-results");n[0].classList.value.includes("v2")?(n.toggleClass("layout-list-v2").toggleClass("layout-thumb-v2"),window.dispatchEvent(new Event("resize"))):n.toggleClass("layout-list").toggleClass("layout-thumb"),$(".format a").toggleClass("active")}),!1}),$(document).on("click",".btn-renew",function(n){const i=$(this);return i.find("i").addClass("fa-spin"),$.post(i.attr("href"),function(r){I("Votre annonce a \xE9t\xE9 renouvel\xE9e"),i.find("i").removeClass("fa-spin"),i.prop("disabled","disabled").off("click").removeAttr("href").removeClass(["btn-renew"]).addClass(["text-muted","nope"]),$(n.target).parents(".occasion-row").find(".occasion-expiration time").addClass("text-success").text(r)}),!1}),$("input[id$=email]").on("blur",n=>{const i=$(n.target),r=i.val();if(r.trim().length===0||r.indexOf("@")!==-1)return;const o=i.parents(".form-group"),l=o.find(".invalid-feedback");l.html('<i class="fa fa-spin fa-spinner"></i>'),$.post({url:$("body").data("test-email-url"),data:{email:r},success:u=>{r===u.email&&(u.valid?(o.removeClass("is-invalid"),l.text(""),i.css("border-color","")):(o.addClass("is-invalid"),i.css("border-color","#a94442"),l.text("Votre email semble invalide, rev\xE9rifiez-le.")))}})})});window.showThreeSixtyModal=function(){const d=document.getElementById("threeSixtyModal");d&&d.addEventListener("shown.bs.modal",()=>{const t=$("[data-pannellum-path]"),e=t.data("pannellum-path");window.pannellum.viewer(t.attr("id"),{type:"cubemap",cubeMap:[e+"/pz.jpeg",e+"/px.jpeg",e+"/nz.jpeg",e+"/nx.jpeg",e+"/py.jpeg",e+"/ny.jpeg"],autoLoad:!0,hotSpots:t.data("hotspots"),strings:{loadButtonLabel:"Charger la vue 360\xB0",loadingLabel:"Chargement .."}})})};window.setupWpnWidget=(d,t)=>{const e=new window.WebPush(d,t),n=$(".wpn-toggle");let i=null;const r=f=>{n.parents(".account-cta").find("i").removeClass(["fa-ellipsis-h"]).addClass("fa-bell"),n.prop("disabled",!1).find("span").text(f?"Je me d\xE9sabonne":"Je m'abonne"),l(f)},o=()=>{n.parents(".account-cta").find("i").addClass(["fa-ellipsis-h"]).removeClass("fa-bell"),n.prop("disabled",!0).find("span").text("En cours..")},l=f=>{$(".wpn .status").html(f?"Vous \xEAtes d\xE9j\xE0 abonn\xE9.":"S'abonner")},u=()=>{const f=localStorage.getItem("platformDetails");return f?(localStorage.setItem("_platformDetails",f),localStorage.removeItem("platformDetails"),!0):!1};n.on("click",function(){o(),i===!1?e.subscribe(function(){i=!0,r(i)},f=>{console.error(f),r(!1)}):i===!0&&e.unsubscribe(function(){i=!1,r(i)},f=>{console.error(f),r(!0)})}),e.setupRegistration("/sw.js",function(f){i=f==="subscribed"},()=>{},u),e.checkSubscription(function(f){i=f==="subscribed",r(i)},()=>{i=!1},u)};window.Comments=A;window.automobile={validation:{noEmoji:function(d,t,e){/\p{Extended_Pictographic}/u.test(d)&&t.push(e.message)},noLinks:function(d,t,e){d.toLowerCase().includes("http")&&t.push(e.message)}}};
